const express = require('express');
const app = express();
const path = require('path');
const bodyParser = require('body-parser');  // Import body-parser

const PORT = 3000;
app.set('view engine', 'ejs');
app.set('views', path.join(__dirname, 'views'));
app.use(bodyParser.urlencoded({ extended: false }));  // Use body-parser to parse form data
app.use(express.static(__dirname + '/public'));const mcqs = [
    { question: 'ما هي الوسيلة الأساسية لراحة القلب وطمأنينته؟', options: ['المال', 'الإيمان بالله', 'الصحة الجسدية', 'الراحة النفسية'], answer: 'الإيمان بالله'},
    { question: 'ما هو المطلب الأسمى لكل إنسان وفقًا للمؤلف؟', options: ['الثروة', 'السعادة', 'الشهرة', 'الراحة الجسدية'], answer: 'السعادة'},
    { question: 'ما الذي يؤدي إلى الحياة الطيبة والسرور؟', options: ['العيش بدون مشاكل', 'التقوى والعمل الصالح', 'المال الوفير', 'السفر'], answer: 'التقوى والعمل الصالح'},
    { question: 'من أين يستمد المؤمن قوته النفسية؟', options: ['من عقلته', 'من توكله على الله', 'من المساعدات الاجتماعية', 'من الصحة الجيدة'], answer: 'من توكله على الله'},
    { question: 'أي من الآتي يعتبر سببًا طبيعيًا لراحة القلب؟', options: ['الإيمان', 'التفكير في المستقبل', 'التخلص من الهموم', 'العمل الجاد'], answer: 'التخلص من الهموم'},
    { question: 'ما الذي يجب على المؤمن أن يفعله إذا أصابه مكروه؟', options: ['ينعزل عن الناس', 'يقارن بين النعم والمصائب', 'يكثر من التفكير في المصيبة', 'يلوم نفسه'], answer: 'يقارن بين النعم والمصائب'},
    { question: 'ما الذي يُعتبر من أعظم أسباب زوال الهموم؟', options: ['المال', 'الدعاء', 'النوم', 'الرياضة'], answer: 'الدعاء'},
    { question: 'متى يحقق الله للعبد ما دعاه ورجاه؟', options: ['عندما يكون في سفر', 'إذا كان القلب حاضرًا ونية صادقة', 'عندما يحصل على المال', 'إذا كان يعيش في راحة'], answer: 'إذا كان القلب حاضرًا ونية صادقة'},
    { question: 'كيف يمكن للعبد أن يخفف من همومه؟', options: ['بزيادة الاهتمام بالمستقبل', 'بتقدير أسوأ الاحتمالات', 'بتجاهل الواقع', 'بالانعزال عن الناس'], answer: 'بتقدير أسوأ الاحتمالات'},
    { question: 'ما هو الدعاء الذي ذكره المؤلف ويحث عليه؟', options: ['اللهم إني أسالك السعادة', 'اللهم رحمتك أرجو فلا تكلني إلى نفسي طرفة عين', 'اللهم ارزقني الصبر', 'اللهم اجعلني من الصابرين'], answer: 'اللهم رحمتك أرجو فلا تكلني إلى نفسي طرفة عين'},
    { question: 'ما الذي يسبب شقاء الإنسان بحسب المؤلف؟', options: ['قلة المال', 'التفكير الزائد', 'الكسل', 'الإيمان الضعيف'], answer: 'التفكير الزائد'},
    { question: 'كيف يواجه المؤمن الأوقات الصعبة؟', options: ['بالانزعاج والغضب', 'بالتوكل على الله والرضا', 'بالانعزال', 'بالتظاهر بالقوة'], answer: 'بالتوكل على الله والرضا'},
    { question: 'ما الفرق بين المؤمن وغير المؤمن في مواجهة المكاره؟', options: ['المؤمن يستسلم سريعًا', 'المؤمن يواجه المكاره بالصبر والتوكل على الله', 'المؤمن يهرب من المشاكل', 'غير المؤمن يتحمل أكثر'], answer: 'المؤمن يواجه المكاره بالصبر والتوكل على الله'},
    { question: 'كيف يمكن للمؤمن أن يزيل القلق من قلبه؟', options: ['بالاهتمام بالماضي', 'بالاشتغال بأعمال نافعة', 'بالاستسلام للأوهام', 'بالابتعاد عن الناس'], answer: 'بالاشتغال بأعمال نافعة'},
    { question: 'ما هو العلاج الذي ذكره المؤلف لأمراض القلب العصبية؟', options: ['الاستماع إلى الموسيقى', 'قوة القلب وعدم الاستسلام للأوهام', 'العلاج الطبي', 'تغيير البيئة'], answer: 'قوة القلب وعدم الاستسلام للأوهام'},
    { question: 'ما الذي يجب على المؤمن فعله عندما يحدث شيء مؤلم له؟', options: ['أن يلوم الآخرين', 'أن يطمئن ويؤمن بأن ذلك اختبار من الله', 'أن يسعى للانتقام', 'أن يظل في حالة من الغضب'], answer: 'أن يطمئن ويؤمن بأن ذلك اختبار من الله'},
    { question: 'كيف يُعدّ المؤمن في تعاملاته مع الآخرين؟', options: ['قاسيًا في تعاملاته', 'متسامحًا وصبورًا', 'غاضبًا دائمًا', 'منعزلًا عن الجميع'], answer: 'متسامحًا وصبورًا'},
    { question: 'ما هو دور ذكر الله في راحة القلب؟', options: ['يجعل الإنسان يفكر في مشاكله', 'يؤدي إلى تطهير النفس وزوال القلق', 'يزيد من الحزن', 'يؤدي إلى الخوف'], answer: 'يؤدي إلى تطهير النفس وزوال القلق'},
    { question: 'ما الذي يساعد في التخلص من التوتر العصبي؟', options: ['التفكير في الماضي', 'تجنب التفكير في أي شيء', 'العمل المفيد والتعلم', 'الاستسلام للألم'], answer: 'العمل المفيد والتعلم'},
    { question: 'ما هو سبب السعادة الدائمة بحسب المؤلف؟', options: ['المال والثراء', 'الصحة والعافية', 'الإيمان والعمل الصالح', 'الشهرة والاعتراف الاجتماعي'], answer: 'الإيمان والعمل الصالح'},
    { question: 'ما الذي يساعد المؤمن في التعامل مع الأوقات العصيبة؟', options: ['الجهل بالمستقبل', 'التفاؤل دون العمل', 'التوكل على الله والصبر', 'التفكير المستمر في الأمور السلبية'], answer: 'التوكل على الله والصبر'},
    { question: 'كيف يتعامل المؤمن مع الخوف؟', options: ['يتجاهل المخاوف', 'يستسلم للخوف', 'يعتمد على الله ويثق في قدرته', 'ينشغل بالقلق'], answer: 'يعتمد على الله ويثق في قدرته'},
    { question: 'أي من التالي يساعد في التخلص من التوتر؟', options: ['التفكير في الماضي', 'التخلي عن المشاعر السلبية', 'القلق من المستقبل', 'الاشتغال بالعمل الجاد'], answer: 'الاشتغال بالعمل الجاد'},
    { question: 'كيف يجب على المؤمن أن يتعامل مع المصائب؟', options: ['بنكران', 'بالصبر والرضا', 'بالهرب', 'بالانتقام'], answer: 'بالصبر والرضا'},
    { question: 'ما الذي يمكن أن يساعد في إزالة القلق بحسب الكتاب؟', options: ['التأمل في النعم', 'التفكير في الفقر', 'القلق من المستقبل', 'تجاهل التحديات'], answer: 'التأمل في النعم'},
    { question: 'ماذا يجب أن يفعل الإنسان عند مواجهته للمشاكل؟', options: ['يتحمل وحده', 'يطلب المساعدة من الآخرين', 'ينعزل ويشعر بالضيق', 'يتوكل على الله ويصبر'], answer: 'يتوكل على الله ويصبر'},
    { question: 'كيف يتعامل المؤمن مع الخوف؟', options: ['يتجاهل المخاوف', 'يستسلم للخوف', 'يعتمد على الله ويثق في قدرته', 'ينشغل بالقلق'], answer: 'يعتمد على الله ويثق في قدرته'},
    { question: 'ما الذي يساعد المؤمن في التعامل مع الأوقات العصيبة؟', options: ['الجري بعيدًا عن المشكلة', 'التركيز على الأمور السلبية', 'التوكل على الله والرضا بالقضاء', 'الانعزال عن الجميع'], answer: 'التوكل على الله والرضا بالقضاء'}
];

// Function to get 15 random MCQs from the list
function getRandomMCQs() {
    const shuffled = mcqs.sort(() => 0.5 - Math.random());
    return shuffled.slice(0, 15);
}
const randomMCQs = getRandomMCQs();
app.get('/', (req, res) => {
    
    res.render('index', { mcqs: randomMCQs });
});

app.get('/quiz', (req, res) => {
    res.render('quiz', { mcqs: randomMCQs });
});

app.post('/submit', (req, res) => {
    const userAnswers = req.body;
    let score = 0;
    mcqs.forEach((mcq, index) => {
        const userAnswer = userAnswers['question'+index ]
        if (userAnswer === mcq.answer) {
            score++;
        }
    });
    res.render( "resalt" , {length:randomMCQs.length, score:score , per:Math.floor(score/randomMCQs.length*100)});
});

app.listen(PORT, () => {
    console.log(`Server is running on http://localhost:${PORT}`);
});
